<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />

    <style>
     :root {
       --accent-color: #05a081;
       --accent-color-light: #82d0c0;
     }
    </style>

    <meta name="theme-color" content="#05a081" />

    
    <link rel="alternate" type="application/atom+xml" title="RSS" href="https://wtfleming.github.io/atom.xml">
    

    
    
    
    
    
    
    
    
    
    <link rel="icon" href="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.b722df128754d46d.png" />

    <link rel="apple-touch-icon" sizes="48x48" href="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.b722df128754d46d.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.6cc6de892c65b543.png" />
    <link rel="apple-touch-icon" sizes="96x96" href="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.05bb94ecb36c25eb.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.f51b5e0bcc4516db.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.eae6a2274aff6419.png" />
    <link rel="apple-touch-icon" sizes="256x256" href="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.2e54fa9ad4d11bdb.png" />
    <link rel="apple-touch-icon" sizes="384x384" href="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.809ea1a0e3c3f3e0.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.7c64c06f3e2d7a67.png" />
    

    

      <meta property="og:type" content="website">

      <meta name="twitter:card" content="summary">

      

      

      
      
      <meta name="description" content="" />
      <meta name="twitter:description" content="">
      
      

      
      <meta name="twitter:title" content="Dockerizing a Clojure, Compojure, and HTTP Kit Web Application">
      

      
      <link rel="prerender" href="&#x2F;about&#x2F;" />
      
      <link rel="prerender" href="&#x2F;blog&#x2F;" />
      


      
      <link rel="prefetch" href="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.9401710308142458.png" />

    <title>
      
        
          Dockerizing a Clojure, Compojure, and HTTP Kit Web Application
        
      
    </title>

    
    
      <link rel="stylesheet" href="https://wtfleming.github.io/main.css">
    
    
  

  

  
    <link rel="prerender"  href="https://wtfleming.github.io/tags/clojure/">
  
    <link rel="prerender"  href="https://wtfleming.github.io/tags/docker/">
  

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://google.com/article"
      },
      "headline": "Dockerizing a Clojure, Compojure, and HTTP Kit Web Application",
      "image": [],
      "datePublished": "2014-11-29T00:00:00+00:00",
      "dateModified": "2014-11-29T00:00:00+00:00"
    }
  </script>

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        

        
        {
          
          "@type": "ListItem",
          "position": 1,
          "name": "Will&#x27;s Software Journal",
          "item": "https://wtfleming.github.io/"
        },
        
        {
          
          "@type": "ListItem",
          "position": 2,
          "name": "",
          "item": "https://wtfleming.github.io/blog/"
        },
        
        {
          "@type": "ListItem",
          "position": 3,
          "name": "Dockerizing a Clojure, Compojure, and HTTP Kit Web Application",
          "item": "https://wtfleming.github.io/blog/dockerize-clojure-compojure-http-kit-web-application/"
        }
      ]
    }
  </script>

  </head>
  <body>
    
    <header>
      
        <a class="profile-icon" href="/">
          <img src="https:&#x2F;&#x2F;wtfleming.github.io&#x2F;processed_images&#x2F;icon.9401710308142458.png" alt="profile picture">
        </a>
        <nav>
          
            <a href="&#x2F;about&#x2F;">About</a>
          
            <a href="&#x2F;blog&#x2F;">Blog</a>
          
        </nav>
      </header>
    
    <main>
    
  <div class="post-title">
    <h1>Dockerizing a Clojure, Compojure, and HTTP Kit Web Application</h1>
    <small>
      November 29, 2014
      
        - 
        <span class="tags">
          
            <a href="https://wtfleming.github.io/tags/clojure/">clojure</a>
          
            <a href="https://wtfleming.github.io/tags/docker/">docker</a>
          
        </span>
      
    </small>
  </div>

  <div>
    <p><a href="https://www.docker.com/">Docker</a> is "an open platform for developers and sysadmins to build, ship, and run distributed applications. With Docker, developers can build any app in any language using any toolchain. Dockerized apps are completely portable and can run anywhere - colleaguesâ€™ OS X and Windows laptops, QA servers running Ubuntu in the cloud, and production data center VMs running Red Hat."</p>
<p>Here we will build a very simple web site using the Clojure <a href="https://github.com/weavejester/compojure">Compojure</a> and <a href="https://www.http-kit.org/">HTTP Kit</a> libraries.
The source code for this article is also available <a href="https://github.com/wtfleming/docker-compojure-hello-world">here</a>.</p>
<h1 id="create-a-compojure-application">Create a Compojure Application</h1>
<p>First create a file named <em>project.clj</em> with the following contents:</p>
<pre data-lang="clojure" style="background-color:#2b303b;color:#c0c5ce;" class="language-clojure "><code class="language-clojure" data-lang="clojure"><span>(</span><span style="color:#b48ead;">defproject </span><span style="color:#8fa1b3;">hello-world </span><span>&quot;</span><span style="color:#a3be8c;">0.1.0</span><span>&quot;
</span><span>  </span><span style="color:#d08770;">:description </span><span>&quot;</span><span style="color:#a3be8c;">Compojure hello world web app</span><span>&quot;
</span><span>  </span><span style="color:#d08770;">:url </span><span>&quot;</span><span style="color:#a3be8c;">https://github.com/wtfleming/docker-compojure-hello-world</span><span>&quot;
</span><span>  </span><span style="color:#d08770;">:min-lein-version </span><span>&quot;</span><span style="color:#a3be8c;">2.0.0</span><span>&quot;
</span><span>  </span><span style="color:#d08770;">:dependencies </span><span>[[org.clojure/clojure &quot;</span><span style="color:#a3be8c;">1.6.0</span><span>&quot;]
</span><span>                 [compojure &quot;</span><span style="color:#a3be8c;">1.2.1</span><span>&quot;]
</span><span>                 [http-kit &quot;</span><span style="color:#a3be8c;">2.1.16</span><span>&quot;]]
</span><span>  </span><span style="color:#d08770;">:main</span><span> hello-world.core
</span><span>  </span><span style="color:#d08770;">:aot </span><span>[hello-world.core])
</span></code></pre>
<p>And then create a file named <em>src/hello_world/core.clj</em> with these contents:</p>
<pre data-lang="clojure" style="background-color:#2b303b;color:#c0c5ce;" class="language-clojure "><code class="language-clojure" data-lang="clojure"><span>(</span><span style="color:#bf616a;">ns</span><span> hello-world.core
</span><span>  (</span><span style="color:#d08770;">:require </span><span>[compojure.core </span><span style="color:#d08770;">:refer :all</span><span>]
</span><span>            [org.httpkit.server </span><span style="color:#d08770;">:refer </span><span>[run-server]])
</span><span>  (</span><span style="color:#d08770;">:gen-class</span><span>))
</span><span>
</span><span>(</span><span style="color:#b48ead;">defroutes </span><span style="color:#8fa1b3;">myapp
</span><span>  (</span><span style="color:#bf616a;">GET </span><span>&quot;</span><span style="color:#a3be8c;">/</span><span>&quot; [] &quot;</span><span style="color:#a3be8c;">Hello World</span><span>&quot;))
</span><span>
</span><span>(</span><span style="color:#b48ead;">defn </span><span style="color:#8fa1b3;">-main </span><span>[]
</span><span>  (</span><span style="color:#bf616a;">let </span><span>[port (</span><span style="color:#bf616a;">Integer/parseInt </span><span>(</span><span style="color:#bf616a;">or </span><span>(</span><span style="color:#bf616a;">System/getenv </span><span>&quot;</span><span style="color:#a3be8c;">PORT</span><span>&quot;) &quot;</span><span style="color:#a3be8c;">8080</span><span>&quot;))]
</span><span>    (</span><span style="color:#bf616a;">run-server</span><span> myapp {</span><span style="color:#d08770;">:port</span><span> port})
</span><span>    (</span><span style="color:#bf616a;">println </span><span>(</span><span style="color:#bf616a;">str </span><span>&quot;</span><span style="color:#a3be8c;">Listening on port </span><span>&quot; port))))
</span></code></pre>
<p>This is a very basic Compojure/HTTP Kit app with a single route that displays a web page with the contents "Hello World".
We also check to see if an environment variable PORT has been defined, and if so bind to it, otherwise default to port 8080.</p>
<p>Now build with <a href="http://leiningen.org/">Leiningen</a>.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ lein uberjar
</span></code></pre>
<p>You could now run locally like this</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ java -jar target/hello-world-0.1.0-standalone.jar
</span></code></pre>
<p>Browse to http://localhost:8080 and you should see a page that displays "Hello World".</p>
<h1 id="create-a-dockerfile">Create a Dockerfile</h1>
<p>Now create a file called <em>Dockerfile</em> with these contents</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>#
</span><span># Dockerfile for a compojure hello world app
</span><span>#
</span><span>
</span><span>FROM java:openjdk-8-jre
</span><span>MAINTAINER Will Fleming &lt;wfleming77@gmail.com&gt;
</span><span>ENV REFRESHED_AT 2014-11-25
</span><span>
</span><span>COPY target/hello-world-0.1.0-standalone.jar hello-world-0.1.0-standalone.jar
</span><span>
</span><span>ENV PORT 4000
</span><span>
</span><span>EXPOSE 4000
</span><span>
</span><span>CMD [&quot;java&quot;, &quot;-jar&quot;, &quot;hello-world-0.1.0-standalone.jar&quot;]
</span></code></pre>
<p>The Dockerfile is a set of instructions to build a docker container.</p>
<ul>
<li>
<p>We copy the jar file from our file system to the docker filesystem.</p>
</li>
<li>
<p>Define a environment variable PORT with the value 4000.</p>
</li>
<li>
<p>Expose port 4000 to other docker containers.</p>
</li>
<li>
<p>Provide a default command to be run when starting the container.</p>
</li>
</ul>
<p>There is much more you can do, the <a href="https://docs.docker.com/reference/builder/">Dockerfile documentation</a> goes into further detail.</p>
<h1 id="build-a-docker-image">Build a Docker Image</h1>
<p>Now lets build a Docker image.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ docker build -t wtfleming/compojure-hello-world .
</span></code></pre>
<p>We can see that it was built:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ docker images
</span><span>REPOSITORY                        TAG     IMAGE ID       CREATED      VIRTUAL SIZE
</span><span>wtfleming/compojure-hello-world   latest  b1c798937b9d   6 days ago   351.1 MB
</span></code></pre>
<p>We can use an image as the basis to launch a container.</p>
<h1 id="run-a-docker-container">Run a Docker container</h1>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ docker run --rm -p 4000:4000 wtfleming/compojure-hello-world
</span><span>Listening on port 4000
</span></code></pre>
<p>In the above we:</p>
<ul>
<li>Start a container from the wtfleming/compojure-hello-world image.</li>
<li>--rm will delete the container when it stops</li>
<li>-p will publish a container's port to the host</li>
</ul>
<p>Open a web browser to http://localhost:4000 and you will see the page.</p>
<p>Browse to http://localhost:4000 or if you are on a Mac or Windows using boot2docker find the ip address like</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ boot2docker ip
</span><span>The VM&#39;s Host only interface IP address is: 192.168.59.103
</span></code></pre>
<p>and browse to the ip provided by boot2docker like http://192.168.59.103:4000</p>

  </div>

  <hr class="footer-rule" />

  

  <div class="related-container">

    

    

  </div>


    </main>
  </body>
</html>
